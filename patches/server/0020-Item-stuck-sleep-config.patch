From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: tr7zw <tr7zw@live.de>
Date: Fri, 31 Jul 2020 21:48:14 -0500
Subject: [PATCH] Item stuck sleep config

Original code by Yatopia, licensed under MIT License

diff --git a/src/main/java/net/minecraft/world/entity/item/ItemEntity.java b/src/main/java/net/minecraft/world/entity/item/ItemEntity.java
index f6b9f56076bd6aa2d912deacef0dff75a5ac01f4..908ec2bc4f6dfe359077d09b7355b26c9752a683 100644
--- a/src/main/java/net/minecraft/world/entity/item/ItemEntity.java
+++ b/src/main/java/net/minecraft/world/entity/item/ItemEntity.java
@@ -145,7 +145,7 @@ public class ItemEntity extends Entity {
 
             if (this.level.isClientSide) {
                 this.noPhysics = false;
-            } else {
+            } else if (!this.onGround || this.noPhysics || this.tickCount % org.sugarcanemc.sugarcane.config.SugarcaneConfig.itemStuckSleepTicks == 0) { // Sugarcane - Item stuck sleep config
                 this.noPhysics = !this.level.noCollision((Entity) this, this.getBoundingBox().deflate(1.0E-7D), (entity) -> {
                     return true;
                 });
diff --git a/src/main/java/org/sugarcanemc/sugarcane/config/SugarcaneConfig.java b/src/main/java/org/sugarcanemc/sugarcane/config/SugarcaneConfig.java
index 683efd938a2de6c9a8626394547701ec05d734d6..9955a79ae36ee20092588d8b0c59208cea7b422c 100644
--- a/src/main/java/org/sugarcanemc/sugarcane/config/SugarcaneConfig.java
+++ b/src/main/java/org/sugarcanemc/sugarcane/config/SugarcaneConfig.java
@@ -109,6 +109,7 @@ public class SugarcaneConfig {
 	public static boolean logPlayerLoginLoc;
 	public static boolean checkFlying;
 	public static boolean checkVehicleFlying;
+	public static int itemStuckSleepTicks;
 
 	private static void settings() {
 		config.setComment("brand-name", "Here you can set what should your server display as it's brand name", "NOTE: This settings overrides the purpur's server-mod-name setting");
@@ -138,4 +139,10 @@ public class SugarcaneConfig {
 
 		checkVehicleFlying = config.getBoolean("checks.vehicle-flight", true);
 	}
+
+	private static void itemStuckSleepTicks() {
+		config.setComment("item", "The setting below controls how often a dropped item checks rather it's stuck inside a block (their most expansive operation)", "Higher values like 15 can be safely used and greatly improves dropped item", "if your server has thousands of them (from big farms/TNT/farming players etc).");
+
+		itemStuckSleepTicks = config.getInt("item.item-stuck-sleep-ticks", 1);
+	}
 }
\ No newline at end of file
